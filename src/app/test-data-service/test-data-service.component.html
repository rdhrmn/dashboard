<div>
  <h3>
      Servcie Test details
  </h3>
  <div class="col span_1_of_2" id="SelectService">
    <div class="input-group">
      <div class="input-group-btn">
        <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" selected="selected">
          {{currData.env.envName}}
        </button>
        <ul class="dropdown-menu">
            <ng-container *ngFor="let uniqueEnvDiv of uniqueEnvDivs">
              <li role="separator" class="dropdown-divider"></li>
              <li class="dropdown-header">{{uniqueEnvDiv}}</li>
              <ng-container *ngFor="let env of envs">
                <ng-container *ngIf="env.envDiv === uniqueEnvDiv">
                  <li class="dropdown-item" (click)="currData.env.envName=env.envName; currData.env.envId=env.id;">{{env.envName}}</li>
                </ng-container>
              </ng-container>
            </ng-container>
          </ul>
      </div>
      <span class="btn btn-secondary" id="ServiceList">Service -> </span>
      <!-- <span class="input-group-addon" id="ServiceList">SelectService</span> --> <!-- changed class for same button colour-->
      <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        {{currData.service.name}}-{{currData.service.operation}}
      </button>
      <ul class="dropdown-menu pull-right">
          <ng-container *ngFor="let uniqueServiceArea of uniqueServiceAreas">
            <li role="separator" class="dropdown-divider"></li>
            <li class="dropdown-header">{{uniqueServiceArea}}</li>
            <ng-container *ngFor="let service of services">
              <ng-container *ngIf="service.serviceArea === uniqueServiceArea">
                <li class="dropdown-item"(click)="currData.service.name=service.name; currData.service.operation=service.operation; currData.service.serviceId=service.id; getTestDataFromEnvForService();">{{service.name}}-{{service.operation}}</li>
              </ng-container>
            </ng-container>
          </ng-container>
        </ul>
      <!-- <select class="form-control" id="chooseServices">
          <option>CCI-OP-Default</option>
          <option>CCI-OP-Digital</option>
          <option>SCI-OP-Default</option>
          <option>4</option>
      </select> -->
    </div>
        <!-- <input type="text" class="form-control" aria-label="Text input with dropdown button"> -->
  </div>
  <!-- <textarea >Test: ENV = {{currData.env.envId}} : {{currData.env.envName}} : SERVICE = {{currData.service.serviceId}} : {{currData.service.name}} : {{currData.service.operation}} </textarea> -->
  <div id= filtering style='font:50%/1 sans-serif' >
    <!-- Name: <input type='text' [(ngModel)]="recordHighlightParam" ng-init="recordHighlightParam=10">
    <h1>{{recordHighlightParam}}</h1> -->
    Filtering choices:
    <section class="selection">
        <!-- <input type='text' value="Filter" /> -->
        <input type='text' style='padding:8px;margin:1px auto;width:90%;'
        placeholder='Filter the useCases...'
        (keyup)='updateFilter($event)'
        />
        <!-- <input type='text' value="Filter" /> -->
        <input type='text'  style='padding:8px;margin:1px auto;width:90%;'
          placeholder='ResponseTime<100'
        />
        <!-- <input type='text' value="Filter" /> -->
        <input type='text'  style='padding:8px;margin:1px auto;width:90%;'
          placeholder='CellSelection==Test'
        />
        <!-- <input type='text' style='background-color:slateblue;font-size:20px' value="Filter" /> -->
        <!-- <input type='text'  style='padding:8px;margin:1px auto;width:100%; '
          placeholder='Type to filter the name column...'
        /> -->
        <!-- <input type='text' value="Filter" /> -->
        <!-- <input type='text'  style='padding:8px;margin:1px auto;width:90%;'
          placeholder='Type to filter the name column...'
        /> -->
      </section>
  </div>
</div>

<div>
  <!-- <textarea ></textarea> -->
    <!-- <div style='float:left;width:75%'> -->
<div class="section group" style='margin-bottom: 0px;'>
  <div class="col span_3_of_4" >
    <!-- <div class="info">
      <p> abcd</p>
    </div> -->

    <ngx-datatable
      class="material"

      [rows]="rows"
      [limit]="5"

      [columns]="columns"
      [columnMode]="'force'"

      [headerHeight]="50"
      [footerHeight]="50"
      [rowHeight]="'auto'"

      [selected]="selected"
      [selectionType]="'multi'"
      (activate)="onActivate($event)"
      (select)='onSelect($event)'

      [selected]="selected"
      [selectionType]="'cell'"
      (select)="onCellSelect($event)"
      (activate)="onCellActivate($event)"

      [scrollbarH]="true"

      (tableContextmenu)="onTableContextMenu($event)"

      [rowClass]="getRowClass"
    >

    <ngx-datatable-column name="Id" [width]="30">
      <ng-template ngx-datatable-cell-template let-value="value">
        {{value}}
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="ServcieOperation" prop="serviceId" [width]="120">
      <ng-template ngx-datatable-cell-template let-value="value">
          {{value}}
          <!-- {{(services | filter: {id:value})[0].name}} -->
          <!-- <span value={{value * 1}}>{{value}}</span> -->
          <!-- <span ng-repeat="service in services" ng-show="service.id==value">
               {{service.id}}
          </span> -->
          <!-- <span "value=services.find( service => service.id === '1').name">{{value}}</span> -->
          <!-- <span "value=100">{{value}}</span> -->
          <!-- {{currData.service.name}} -->
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="UseCase" prop="useCase">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
          <span
            title="Double click to edit"
            (dblclick)="editedRow[rowIndex + '-UseCase'] = true"
            *ngIf="!editedRow[rowIndex + '-UseCase']">
            {{value}}
          </span>
          <input
            autofocus
            (blur)="updateValue($event, 'UseCase', rowIndex)"
            *ngIf="editedRow[rowIndex+ '-UseCase']"
            type="text"
            [value]="value"
          />
        </ng-template>
      </ngx-datatable-column>
    <ngx-datatable-column name="touchPoints">
        <ng-template ngx-datatable-cell-template let-value="value">
          {{value}}
        </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="responseTime" [width]="100">
        <ng-template ngx-datatable-cell-template let-value="value">
            <span tooltip="Is it working as tool tip" span></span>
          {{value}}
        </ng-template>
      </ngx-datatable-column>
    <ngx-datatable-column name="requestId">
        <ng-template ngx-datatable-cell-template let-value="value">
          {{value}}
        </ng-template>
      </ngx-datatable-column>
    <ngx-datatable-column name="responseId">
      <ng-template ngx-datatable-cell-template let-value="value">
        {{value}}
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="envId" [width]="60">
      <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row" let-value="value">
        <span
        title="Double click to edit"
        (dblclick)="editedRow[rowIndex + '-envId'] = true"
        *ngIf="!editedRow[rowIndex + '-envId']">
        {{value}}
        </span>
        <select
          *ngIf="editedRow[rowIndex + '-envId']"
          (blur)="editedRow[rowIndex + '-envId'] = false"
          (change)="updateValue($event, 'envId', rowIndex)"
          [value]="value">
          <option value="replica">REPLICA</option>
          <option value="o2a">O2A</option>
          <option value="new">N2A</option>
        </select>
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="testdataType" headerClass="is-testdata" [cellClass]="getCellClass" [width]="100">
      <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row" let-value="value">
        <span
        title="Double click to edit"
        (dblclick)="editedRow[rowIndex + '-testdatatype'] = true"
        *ngIf="!editedRow[rowIndex + '-testdatatype']">
        {{value}}
        </span>
        <select
          *ngIf="editedRow[rowIndex + '-testdatatype']"
          (blur)="editedRow[rowIndex + '-testdatatype'] = false"
          (change)="updateValue($event, 'testdataType', rowIndex)"
          [value]="value">
          <option value="test">Test</option>
          <option value="actual">Actual</option>
        </select>
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="testType" [width]="100">
      <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row" let-value="value">
        <span
        title="Double click to edit"
        (dblclick)="editedRow[rowIndex + '-testtype'] = true"
        *ngIf="!editedRow[rowIndex + '-testtype']">
        {{value}}
        </span>
        <select
          *ngIf="editedRow[rowIndex + '-testtype']"
          (blur)="editedRow[rowIndex + '-testtype'] = false"
          (change)="updateValue($event, 'testType', rowIndex)"
          [value]="value">
          <option value="info">Info</option>
          <option value="txn">Txn</option>
          <option value="ops">Ops</option>
        </select>
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="dateTime">
      <ng-template ngx-datatable-cell-template let-value="value">
        {{value}}
      </ng-template>
    </ngx-datatable-column>

    </ngx-datatable>
  </div>
  <div class="col span_1_of_4" id="rowconext" style='margin-bottom: 1px; margin-top: 1px;'>
    <form style='border:2px solid #9ed8fa; background: #9ed8fa;' *ngIf="isSelected">
      <fieldset style='background: #9ed8fa;'>
        <legend>Env Settings : {{currData.env.envName}} for {{currData.row.serviceId}}</legend>
        <label for="serviceinstances" style='background: #cafa9e;'>No of instances: 7</label> <br>
        <label for="servicemachines" style='background: #faec9e;'>Machines: IP Address1 (2),IP Address2 (5) </label> <br>
        <label for="servicedeploymentdate" style='background: #cafa9e;'>Last deployed: DateTime</label> <br>
        <label for="servicedeploymentreason" style='background: #faec9e;'>Deployed reason: CRNo</label>
      </fieldset>
    </form>
    <form style='border:2px solid #9ed8fa; background: #9ed8fa;' *ngIf="isSelected">
        <fieldset style='background: #9ed8fa;'>
          <legend>#Service Info for {{currData.row.serviceId}}</legend>
          <textarea cols=80 rows=3 name="servcieInfo" id="servcieInfo" style='font-weight: bold; font-style: italic; background: #6fff47;' maxlength=300 placeholder='servcieInfo in 300 letters, purpose, actors, intent (main parameters)'></textarea>
          <textarea cols=80 rows=3 name="servcieInfo" id="servcieInfo" style='font-weight: bold; font-style: italic; background: #eef592;' maxlength=300 placeholder='a linked list of sequences of activity, highlighting present activity in the sequence, on doubleClick it will take to dependency matric component window'></textarea>
        </fieldset>
      </form>
    <!-- <form style='background: #cafa9e;' *ngIf="contextmenuRow"> -->
    <form style='background: #cafa9e;' *ngIf="isSelected">
      <!-- <button type="submit">Edit</button><button type="submit">Save</button><br> -->
      <fieldset id="debugtempId" style='background: #cafa9e;'>

        <legend>Query Params - {{currData.row.serviceId}}</legend>
        <!-- *ngFor outdated to be replaced with ngForOf -->
        <ng-container *ngFor="let param of currData.requestParams; let i = index">
            <!-- <ng-container *ngIf="env.envDiv === uniqueEnvDiv"> -->
                <label for="name">{{param.name}}</label>
                <input type="text" name="name" id="name" placeholder={{queryitem}} [(ngModel)] = "currData.requestParams[i].value"/>
                <!-- <label for="myval">{{currData.requestParams[i].value}}</label> -->
            <!-- </ng-container> -->
            </ng-container>
        <!-- <label for="mail">E-mail:</label>
        <input type="text" name="mail" id="mail" value ={{selected[0].id}}/>
        <label for="address">Address:</label>
        <input type="text" name="address" id="address" size="40" /> -->
      </fieldset>
      <button type="submit" id="onTest" (click)="onTest()">Test</button> |
      <input type="checkbox" id="actualtest" value="isActual" style="width: 15px;height: 15px;" /><label for="actualtest" style="font:90%/1 sans-serif;font-weight: bold;color:darkblue;">Actual</label> |
      <input type="checkbox" id="unlikeRequestChek" (value)="isUnlikeRequests" style="width: 15px;height: 15px;" /><label for="actualtest" style="font:90%/1 sans-serif;font-weight: bold;color:darkblue;">Against Other</label> |
      <!-- <label class="switch"><input type="checkbox"> <span class="slider round"></span> </label> -->
    </form>
    <!-- <form style='background: #faec9e;' *ngIf="contextmenuRow"> -->
    <form style='background: #faec9e;' *ngIf="isSelected">
        <fieldset style='background: #faec9e;'>
          <legend>Touch Points</legend>
          <input type="text" name="touchpoint1" id="touchpoint1" style='float:left; width:30%; margin:3px;' value='touchpoint1'/>
          <input type="text" name="touchpoint2" id="touchpoint2" style='float:left; width:30%; margin:3px;' value='touchpoint2'/>
          <input type="text" name="touchpoint3" id="touchpoint3" style='float:left; width:30%; margin:3px;' size="40" value='touchpoint3'/>
          <input type="text" name="touchpoint1" id="touchpoint4" style='float:left; width:30%; margin:3px;' value='touchpoint4'/>
        </fieldset>
    </form>
  </div>
</div>
<!-- <hr> -->
  <!-- <div class='selected-column'>
    <h4>Selections</h4>
    <ul>
      <li *ngFor='let sel of selected'>
        Use case: {{sel.useCase}}
      </li>
      <li *ngIf="!selected.length">No Selections</li>
    </ul>
  </div> -->
  <!-- <div class="info"> -->
      <!-- <p *ngIf="rawEvent">On Right click <strong>Mouse position:</strong> <code>(x: {{rawEvent?.x}}, y: {{rawEvent?.y}})</code></p> -->
      <!-- <p *ngIf="contextmenuRow">On Right click <strong>Row:</strong> The TouchPoints : {{contextmenuRow?.touchPoints}}</p> -->
      <!-- <p *ngIf="contextmenuColumn">On Right click <strong>Header:</strong>
        name: {{contextmenuColumn?.name}}
        prop: {{contextmenuColumn?.prop}}
      </p>
  </div> -->

  <div class="ResponseDiff" id="responseDetail">
    <!-- <div class="section group" *ngIf="onTest"> -->
    <div class="section group">
      <!-- <div class="col span_1_of_10" style='margin-bottom: 1px; margin-top: 1px;'>
      <button type="submit">Submit</button><br>
      </div> -->
      <div class="col span_1_of_3" >
          <fieldset>
              <legend>Response message</legend>
          <div class="panel with-nav-tabs panel-primary">
              <div class="panel-heading">
                      <ul class="nav nav-tabs nav-justified" role="tablist">
                          <li class="nav-item"><a class="nav-link active" href="#reponseTreeView" data-toggle="tab" role="tab" >TreeView</a></li>
                          <li class="nav-item"><a class="nav-link" href="#responseXMLView" data-toggle="tab" role="tab" > XMLView</a></li>
                          <li class="nav-item"><a class="nav-link" href="#responseJSON" data-toggle="tab" role="tab" > JSONView</a></li>
                      </ul>
              </div>
              <div class="panel-body">
                  <div class="tab-content">
                      <div class="tab-pane active" id="reponseTreeView" role="tabpanel">
                          <json-tree [json]="workdata.theNewOne" [expand]="false"></json-tree>
                      </div>
                      <div class="tab-pane" id="responseXMLView"role="tabpanel" >
                          <pre lang="xml">
                        {{transformProvider.convertToXml(workdata.theNewOne)}}
                      </pre>

                      </div>
                      <div class="tab-pane" id="responseJSON"role="tabpanel" >

                        <!-- <textarea name="test-deleteit" id="deleteit" cols="30" rows="10"> -->
                            <code>
                                <pre>{{workdata.theNewOne | json}}</pre>
                            </code>

                        <!-- </textarea> -->
                        <!-- {{workdata.theNewOne | json}} -->



                      </div>

                  </div>
              </div>
          </div>
        </fieldset>

      </div>
      <div class="col span_1_of_3">
          <!-- <form> -->
        <fieldset>
          <legend>Working Responses</legend>
          <div class="panel with-nav-tabs panel-primary">
            <div class="panel-heading">
                    <ul class="nav nav-tabs nav-justified" role="tablist">
                        <li class="nav-item"><a class="nav-link active" href="#sameRequestResponses" data-toggle="tab" role="tab" >SameRequest</a></li>
                        <li class="nav-item"><a class="nav-link" href="#differentRequestResponses" data-toggle="tab" role="tab" > DifferentRequest</a></li>
                    </ul>
            </div>
            <div class="panel-body">
                <div class="tab-content">
                    <div class="tab-pane active" id="sameRequestResponses" role="tabpanel">

                        <ng-container *ngFor="let workitem of workdata.workitems; let i = index" >
                            <ng-container *ngIf="workitem.isUnlikeRequests === false">
                                <!-- [style.display]="'inline-block'" [style.border]="'5px solid #bbb'" [style.border-radius]="'10px'" [style.width]="'100%'" -->
                                <!-- [style.box-shadow]="'inset 0px -5px 30px 50px #777'" [style.text-shadow]="'1px 1px 1px #eee'" -->
                                <!-- [style.background-color]="'dodgerblue'" -->
                          <button style='width: 100%; display: inline-block; border-radius:10px; border: 5px solid #bbb;'
                          [style.animation]="workitem.changeDiffStyle['animation']" [style.border-color]="workitem.changeDiffStyle['border-color']"
                          [style.box-shadow]="workitem.changeDiffStyle['box-shadow']" [style.text-shadow]="workitem.changeDiffStyle['text-shadow']"
                          [style.background-color]="workitem.changeDiffStyle['background-color']"
                          [style.border-style]="workitem.changeDiffStyle['border-style']"
                                (mouseover)="workitem.response._envId"
                                (click)="select2nd(workitem.response.id);"
                                (dblclick)="select1st(workitem.response.id);"
                                >
                                <label style='width: 40%; vertical-align: middle;' for="responseId" [mdbTooltip]="workitem.response.responseMsg | json"  mdbWavesEffect>{{workitem.response.id}} for {{workitem.response._servcieId }} </label>
                                <label style='width: 40%; vertical-align: middle;'for="requestParams" [mdbTooltip]="workitem.useCase + ' at ' + workitem.request._envId" mdbWavesEffect>{{workitem.request.requestMsg}}</label>
                                <!-- <ng-template #tipOnWorkResponse> <pre [innerHtml]="workitem.response.responseMsg | json" ></pre> </ng-template> -->
                                <!-- <ng-template #tipOnWorkResponse> <div [innerHtml]= "<code> <pre> worktem.response.responseMsg | json </pre> </code>" ></div> </ng-template> -->
                              <!-- <ng-template #tipOnWorkResponse> <div><code> <pre> [innerHTML] = {{workdata.workitems[i].response.responseMsg | json}} </pre> </code> </div> </ng-template> -->
                                <!-- "<code> <pre>" + {{workitem.response.responseMsg | json }} + "</pre> </code>"  -->
                                <!-- "<code>" +"<pre>" + "worktem.response.responseMsg | json" +  "</pre>" + "</code>" -->
                                <!-- `<code> <pre> {{worktem.response.responseMsg | json}}</pre> </code>` -->
                                </button>
                              <!-- <li class="dropdown-item"(click)="currData.service.name=service.name; currData.service.operation=service.operation; currData.service.serviceId=service.id; getTestDataFromEnvForService();">{{service.name}}-{{service.operation}}</li> -->
                            </ng-container>
                        </ng-container>


<!--                         <button style='width: 100%; display: inline-block; border-radius:10px;
                        box-shadow: inset 0px -5px 30px 50px #777; border: 5px solid #bbb;
                        text-shadow: 1px 1px 1px #eee;'
                            (click)="count = count + 1">
                            <label style='width: 40%;' for="responseId">ResponseId - {{count}}</label>
                            <label style='width: 40%;'for="requestParams">RequestParams</label>
                        </button>
                        <button style='width: 100%; display: inline-block; background-color:dodgerblue;border: 5px solid #bbb;'
                            (click)="count = count + 1">
                            <label style='width: 40%;' for="responseId">ResponseId - {{count}}</label>
                            <label style='width: 40%;'for="requestParams">RequestParams</label>
                        </button> -->
                    </div>
                    <div class="tab-pane" id="differentRequestResponses"role="tabpanel" >
                        <button style='width: 100%; display: inline-block; background-color:slateblue;'
                            (click)="count = count + 1">
                            <label style='width: 40%;' for="responseId">ResponseId - {{count}}</label>
                            <label style='width: 40%;'for="requestParams">RequestParams</label>
                        </button>
                        <button style='width: 100%; display: inline-block; background-color:slateblue;'
                            (click)="count = count + 1">
                            <label style='width: 40%;' for="responseId">ResponseId - {{count}}</label>
                            <label style='width: 40%;'for="requestParams">RequestParams</label>
                        </button>
                    </div>
                </div>
            </div>
          </div>

        </fieldset>


        <!-- </form> -->
      </div>
      <div class="col span_1_of_3" >
        <fieldset>
            <legend>Diff Viewer</legend>
        <div class="panel with-nav-tabs panel-primary">
            <div class="panel-heading">
                    <ul class="nav nav-tabs nav-justified" role="tablist">
                        <li class="nav-item"><a class="nav-link active" href="#diffTreeView" data-toggle="tab" role="tab" >Diff in Tree</a></li>
                        <li class="nav-item"><a class="nav-link" href="#diffGridView" data-toggle="tab" role="tab" > Diff in Grid</a></li>
                        <li class="nav-item"><a class="nav-link" href="#diffRAW" data-toggle="tab" role="tab" > Diff in RAW</a></li>
                    </ul>
            </div>
            <div class="panel-body">
                <div class="tab-content">
                    <div class="tab-pane active" id="diffTreeView" role="tabpanel">
                        <json-tree [json]= "workdata.theDiffData" [expand]="false"></json-tree>
                    </div>
                    <div class="tab-pane" id="diffGridView"role="tabpanel" >
                        <json-tree [json]= "workdata.theDiffData" [expand]="true"></json-tree>
                    </div>
                    <div class="tab-pane" id="diffRAW"role="tabpanel" >
                        <!-- <json-tree [json]= "myDiff2()[0]['op']" [expand]="true"></json-tree> -->
                        <!-- <json-tree [json]= "TestDiff" [expand]="false"></json-tree> -->
                          {{workdata.theDiffData | json}}
                    </div>
                </div>
            </div>
        </div>
      </fieldset>
    </div>
    </div>
  </div>
</div>


<!-- <div class="myOwnJioDetailData">
  <div class="section group">
    <div class="col span_1_of_2" >
      <label id="myOwnJioSubHeader">Request Parameters</label>
        <p><em><b>By default it will display request parameter of selected message in a dynamic grid where name and value can be added or removed or modified. The modified vaule can be saved in same message or new message.
      Then SUBMIT the button to test.
      Display the new response in sideby column.</b></em></p>
    </div>
    <div class="col span_1_of_2">
      <label id="myOwnJioSubHeader">Response Parameters</label>
      <p><em>By default show the last response of the message selected.
      On submit in left column, it display current result</em></p>
    </div>
  </div>
  <div class="section group">
    <div class="col span_1_of_2">
      <label id="myOwnJioSubHeader">Diff against last test</label>
      <p><em>This column will always show the diff against last run that is stored in database.</em></p>
    </div>
    <div class="col span_1_of_2">
        <label id="myOwnJioSubHeader"> Service Running parameters</label>
        <p><em>This column will detail all running parameters, instances server name etc.</em></p>

    </div>
  </div>
</div> -->
